# Enumeration

* sublist3r
* * usage sublist3r -d website.com -> to a file
* * sublist3r subdomain enum
* * nmap sn -Pn -n $subdomains -oG output.txt
* * masscan -iL output.txt -p 0-65535
* crt.sh | certspotter.com
* * %.website.com | %api.website.com | // tomonomnom httpprob
* * curl -i -k 'crt.sh?cat | html2text > dommains.txt
* * cat domain.txt | grep tumblr.com | awk -F " " '{print $5}' |sort -u
* for site in $(cat domains.txt);do curl -s -o /dev/null -I -w "%{http_code}" https://site --max-time 5; printf "- $site \n" & done > alive.txt
* go through alive.txt
* eyewitness -f /root/domains.txt -d screens --all-protocols

* access with un auth account first
* crawl in burp -> max resource pool 100

## ordering 

* mkdir folder.com
* touch all.txt; alive.txt

### Syntax

* source ../.bash_profile 
* crtsh landing.domain.com >> all.txt
* certspotter domain.com | grep dev | ./httprobe
* cat alive.txt | aquatone -chrome-path /usr/bin/chromium -out aq-data
* python webscreenshot.py -w 30 -t chromium -i relativepathofalive.txt -o outputdir
* find tokensdrcd

# installing httprobe
*  git clone -> go build main.go -> ./main

# quaerks
`get nahmsec/recon basg`102910
`add script fucn in -bash.profile > source`
`arrange prior`

# Web cache poisoning 
[video](https://www.youtube.com/watch?v=j2RrmNxJZ5c&feature=emb_logo)
* Get web cache do bidding
* Find unkeyed input (parameter geuss request for reflected response) (Then try xxs X-Forwarded-Host: `a.\"><script>alert(1)</script>) (Check Response)
* Use ?safe=1 in POST/GET to not affect actual users
* Racing request before other (after cache entry expires) 
* Seizing the cache (X-Host: attacker.net) (Response: Age:173 --Cache-Xonr: Pulive, max-age=1800) Exact secont to start spaming)
* Selective poisoning(Respeonse: Vary: User-Agent) for user with same user agent (browser)
* Dom poisioning | (X-Forwarded-Host: burpcollab.net)(when enclosed bodf sds="https:collap.net") (later GET /api/i18n/en Host: https:collap.net)
* Chaininig Unkeyed Input (Joining multiple headers) (X-Forwarded-Host: attacker.com | X-Forwarded-Scheme: nothttps) -> Move
* Route Poisoning (X-Forwarded-Server: canary | reflects in page) create account poison html (X-Forwarded-Server: piosined.domain | <script>alert(doc.domain)</script>
* Hidden Route Poisoning create account poison html (X-Forwarded-Server: piosined.domain.hoster. | <script>alert(doc.domain)</script>
* Xternal cache poisoning (X-Original-URL: /admin | can also swap pages (GET /edu?x=y X-Original-URL: /gambl | loads gambl)
* Internal cache poisoning ( can swap search (GET /edu?x=y X-Original-URL: /edu?x=yyy | loads search for yyy)
* Combo (GET /foo?dest=ettackr.vom X-Original-URL: /fo.js?v=1 -> redirectds


# Cloud skills

* Using droplets for multi-little scan


# Finds
* dev
* test
* api
* internal
* prod
* owa
* active direcr
* app1-...
* ops
* ne
* corp
* bf1 
* gq1

# Mimes, UTF encoding, origin Matching Same origin policy
# Post messaging into iFrame
# CORS CSRF TOKENS 

# XXS Recog (when passed through burp)
* Figure out where data goes, does it get embeded in a tag? Does it get embededded into a string in script tag?
* Figure out aby special handling, Do urls get turned into links, like posts in lvl 1? 
* Figure out how special characters are handled: A good way is to input something like '<>:;"

# Exploit
* use normal alert or if WAF use <img> with bad source omError
* "onmouseover="alert(0);
* http://"onmouseover="alert(0);
* <a href="http://doo.com"style"....">
* html encoding payload : ';alert(1);' 
* *  give final script of <script> var token='';alert(1);'';</script>
* Js string-escaped payload : </script><script> alert(1);</script>

* "><h1>test</h1>
* '+alert(1)+'

# Mitigation 

* Not enought to escape string but replace < with \x3c and > with \x3e hex escape

google "sub.domain.com" github

# Sql Injection and friend
* reveal files "../../../../etc/passwd -> directory traveral
* cmd inject ping google.com;echo test %or; -- Backticks E.g `echo google.com` works as ping google.com
* Sql injection -> 
* * Union : rubish')) UNION SELECT '1', '2', '3', 'password' ... FROM Users --
* * use sleep(1000) in GET /api/users

# Mitigation
* Never Allow user use path seprators /\
* Rarely allow user input run or e.g escapeshellcmd() in php that functions escapse #&;`|?`<
^()[]{}$\, \x0A, \xFF and anu unbalanced code
* Ensure all inputs are proper qualted and passed through proper escaping functions e.g mysql_real_escape_string() in PHP
* USe parameterised quaries
* Use and orm for data access instead of direct queries

# Session Fixation

* Attackeer -> victim go to http://foo.com/login?PHPSESSID=12345SD
* victim login 
* attacker -> http://foo.com _> heres my seesion id give me access
* sending links with session ids 
* then loginin with same session
* * mitgation new session every login and wipes session on logout

# Clickjacking

* using iframe to trick user for malixious use

* * Mitgating : set X-Frame-Options header to deny or same origin

# File inclusion

* when web app allows client run pages with e.g ?page=test with an error failed to open so by passing an actuall page -> code execution
* * mitigation never allow user run pages or extreme whitelist

# File Upload Bugs

* Identify -> header normal Content-Type multipart/form-data
* uploading a ../../repalcefile.php
* Mime types
* mitigation : exlude file uploads to a different domain
* * extreme whitelist Mime-types

# Null terminator

` The null character (\x00, %00, etc) is used to terminate C strings. Computer soes not know how lonf the sting is `

` Using Null byte can read file g.g ?page=/etc/passwd%00`
* Testing when file handling is in scope

# Unchecked Redirects

* When a web app performs an arbituary redirects outside the application

* Phisimg
* POST Redirect link

* Find redirect and trace desitnation

* Dont allow protocol spec remove instances of 'http'

# Password Storage

* Use Bcrypt

# Threat modelling

* Struvtured way of 
* * Light weight : > enumerate entry point
* * document target Assets > user pII and paswd, admin panel, transaction histor, source code, database creds
* * Develop game plan, attack most valuable first
 Top priority:

* Hacktivity (global and program), Program Directory
* Sign-in
* Sign-up forms
* Forgot password
* Contact forms

# Automate

```
fir i in `Command`; do
    crtdh $1 
    ;done
```

# httprobe
* go get -u github.com/tomnomnom/httprobe
* `https://github.com/tomnomnom/httprobe`
