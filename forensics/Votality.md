# Votality

`apt get install votality`

Obtaining a memory capture from machines can be done in numerous ways, however, the easiest method will often vary depending on what you're working with.
For example, live machines (turned on) can have their memory captured with one of the following tools:

* FTK Imager - [Link](https://accessdata.com/product-download/ftk-imager-version-4-2-0)
* Redline - [Link](https://www.fireeye.com/services/freeware/redline.html) *Requires registration but Redline has a very nice GUI
* DumpIt.exe
* win32dd.exe / win64dd.exe - *Has fantastic psexec support, great for IT departments if your EDR solution doesn't support this

These tools will typically output a .raw file which contains an image of the system memory. 
The .raw format is one of the most common memory file types you will see in the wild.

Offline machines, however, can have their memory pulled relatively easily as long as their drives aren't encrypted. For Windows systems,
this can be done via pulling the following file: 

`%SystemDrive%/hiberfil.sys`

hiberfil.sys, better known as the Windows hibernation file contains a compressed memory image from the previous boot. 
Microsoft Windows systems use this in order to provide faster boot-up times, however, we can use this file in our case for some memory forensics!

Things get even more exciting when we start to talk about virtual machines and memory captures. 
Here's a quick sampling of the memory capture process/file containing a memory image for different virtual machine hypervisors:

* VMware - .vmem file
* Hyper-V - .bin file
* Parallels - .mem file
* VirtualBox - .sav file *This is only a partial memory file. You'll need to dump memory like a normal bare-metal system for this hypervisor

These files can often be found simply in the data store of the corresponding hypervisor and often can be simply copied without shutting the associated virtual machine off. 
This allows for virtually zero disturbance to the virtual machine, preserving it's forensic integrity.

# download github python
`git clone https://github.com/volatilityfoundation/volatility.git`
`https://github.com/volatilityfoundation/volatility3.git`

# Python Usage
``

`python2 vol.py pslist -f ../image.bin --profile=Win7SP1x86_23418`

`python2 vol.py netscan -f ../image.bin --profile=Win7SP1x86_23418`

`python2 vol.py psxview -f ../image.bin --profile=Win7SP1x86_23418`

`python2 vol.py consoles -f ../image.bin --profile=Win7SP1x86_23418`

`python2 vol.py cmdline -f ../image.bin --profile=Win7SP1x86_23418`

`python2 vol.py filescan -f ../image.bin --profile=Win7SP1x86_23418 | grep .docx`

`sudo python2 vol.py dumpfiles -Q 0x000000007eb665b8 --name file -D /opt/ -f ../image.bin --profile=Win7SP1x86_23418`

# Python Usage V3

`python3 vol.py -f image.raw windows.info.Info`

`python3 vol.py -f image.raw windows.filescan`

`python3 vol.py -f image.raw windows.pstree.PsTree`

`python3 vol.py -f image.raw windows.dumpfiles --pid="2760"`

# Usage flag{84d5cc7e162895fa0a5834f1efdd0b32} flag{e483bffafbb0db5eabc121846b455bc7}

`volatility -f MEMORY_FILE.raw imageinfo` -> Profile

`volatility -f MEMORY_FILE.raw --profile=PROFILE pslist` -> validating profile / View process

`volatility -f MEMORY_FILE.raw --profile=PROFILE netscan` -> View prev network connection

`volatility -f MEMORY_FILE.raw --profile=Win7SP1x64 consoles` -> view consoles

`volatility -f MEMORY_FILE.raw --profile=Win7SP1x64 cmdline` -> view command run by the service

`volatility -f MEMORY_FILE.raw --profile=Win7SP1x64 memdump -p <pid> -D file/path` -> extract file in service from cmdline profile

`filescan` -> gets all files

`dumpfiles -Q <hex> --name file -D /opt/`


It's fairly common for malware to attempt to hide itself and the process associated with it. That being said,
we can view intentionally hidden processes via the command `psxview` csrss probably have one false


In addition to viewing hidden processes via psxview, we can also check this with a greater focus via the command `ldrmodules`. 
Three columns will appear here in the middle, InLoad, InInit, InMem. If any of these are false, that module has likely been injected which is a really bad thing.
On a normal system the grep statement above should return no output. Which process has all three columns listed as 'False' (other than System)?

Processes aren't the only area we're concerned with when we're examining a machine. Using the `apihooks` command we can view unexpected patches in the standard system DLLs.
If we see an instance where Hooking module: <unknown> that's really bad. This command will take a while to run, however, it will show you all of the extraneous code 
introduced by the malware.

Injected code can be a huge issue and is highly indicative of very very bad things. We can check for this with the command `malfind`. 
Using the full command `volatility -f MEMORY_FILE.raw --profile=PROFILE malfind -D <Destination Directory>` 
we can not only find this code, but also dump it to our specified directory. Let's do this now! We'll use this dump later for more analysis

Last but certainly not least we can view all of the DLLs loaded into memory. DLLs are shared system libraries utilized in system processes. 
These are commonly subjected to hijacking and other side-loading attacks, making them a key target for forensics. 
Let's list all of the DLLs in memory now with the command `dlllist`


Now that we've seen all of the DLLs running in memory, let's go a step further and pull them out! Do this now with the command 
`volatility -f MEMORY_FILE.raw --profile=PROFILE --pid=PID dlldump -D <Destination Directory>` 

# Linux
## Build
`zip _phillip.zip module.dwarf System.map-5.8.0-25-generic` -> dwarf and System.map for built a custom volatility profile

`sudo mv _phillip.zip /usr/local/lib/python2.7/dist-packages/volatility/plugins/overlays/linux/.`

`sudo vol.py --info | grep phillip`

## Usage

`sudo vol.py -f philip-2.raw --profile=Linux_phillipx64 linux_bash`

`sudo vol.py -f philip-1.raw --profile=Linux_phillipx64 linux_enumerate_files | grep /home/lubuntu`

`sudo vol.py -f philip-1.raw --profile=Linux_phillipx64 linux_find_file -i 0xffff95f1c3139f60 -O file`

`sudo vol.py -f philip-2.raw --profile=Linux_phillipx64 linux_enumerate_files | grep /home/lubuntu/.bash_history`

`sudo vol.py -f philip-2.raw --profile=Linux_phillipx64 linux_find_file -i 0xffff95f1c623fc30 -O bash_history`

## Instpect mal files

VirusTotal - [Link](https://www.virustotal.com/gui/home/upload)

Hybrid Analysis - [Link](https://www.hybrid-analysis.com/)




