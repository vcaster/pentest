# Usage
* snap install docker
* docker info|version
* docker images
* docker pull [image_name]
* docker pull mysql/mysql-server:latest
* docker run --name=[container_name] -d mysql/mysql-server:latest (-d detached mode)
* docker run -d -p 8080:80 --name webserver nginx
* docker ps | -a
* docker start | stop | restart | kill | rm  [container_name]
* docker rm $(docker ps -a -q) (removes all stoped containers)
* docker rmi [image_name]
* docker system prune -a (removes images, try -f to force)
* docker create volume [volume_name]
* docker volume ls
* docker volume inspect [volume_name]
* docker volume stop|rm [volume_name]
* docker volume prune
* docker compose ls|build|start|up -d|ps|rm|down|logs -f [service_name]
* docker compose exec [container] bash
* docker compose -p instance2 up -d
* docker compose cp [container_id]:[src] [dest] (vice versa)
```
--name=[container_name] \
--env="MYSQL_ROOT_PASSWORD=my_password" \
--publish 6603:3306 \
```
# Build from Dockerfile

* docker rm -f web_slippy
* docker build --tag=web_slippy .
* docker run -p 1337:1337 --rm --name=web_slippy web_slippy

# Docker push
* docker login
* docker build -t [username]/[tagname]:[version] .
* docket push [username]/[tagname]:[version]

# drop to shell
* docker container exec -it webserver /bin/bash
* sudo docker run -it -v `pwd`:/code ruby:2.7.0 /bin/bash



* ALTER USER 'root'@'localhost' IDENTIFIED BY '<password>';

## docker compose
```
version: '3.8'

services:
  mysql:
    image: mysql
    command: --default-authentication-plugin=mysql_native_password
    restart: unless-stopped
    container_name: mysql-db
    ports:
      - '3306:3306'
    volumes:
      - mysql-data:/var/lib/mysql
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
      MYSQL_DATABASE: company_db

  mssql:
    image: mcr.microsoft.com/mssql/server
    restart: unless-stopped
    container_name: mssql-db
    ports:
      - '1433:1433'
    volumes:
      - mssql-data:/var/opt/mssql
    environment:
      ACCEPT_EULA: 'Y'
      SA_PASSWORD: COSC*457

volumes:
  mysql-data:
    driver: local
  mssql-data:
    driver: local

```

```
services:
  backend:
    build:
      args:
      - NODE_ENV=development
      context: backend # point to folder with Dockerfile
    command: npm run start-watch
    environment:
      - DATABASE_DB=example
      - DATABASE_USER=root
      - DATABASE_PASSWORD=/run/secrets/db-password
      - DATABASE_HOST=db
      - NODE_ENV=development
    ports:
      - 3001:80
      - 9229:9229
      - 9230:9230
    secrets:
      - db-password
    volumes:
      - ./backend/src:/code/src:ro
      - ./backend/package.json:/code/package.json
      - ./backend/package-lock.json:/code/package-lock.json #not shared
      - backend-modules:/opt/app/node_modules # shared
    networks:
      - public
      - private
    depends_on:
      - db
    restart: unless-stopped
  db:
    image: mariadb:10.6.4-focal
    command: '--default-authentication-plugin=mysql_native_password'
    restart: always
    secrets:
      - db-password
    volumes:
      - db-data:/var/lib/mysql
    networks:
      - private
    environment:
      - MYSQL_DATABASE=example
      - MYSQL_ROOT_PASSWORD_FILE=/run/secrets/db-password
  frontend:
    build:
      context: frontend
      target: development
    ports:
      - 3000:3000
    volumes:
      - ./frontend/src:/code/src
      - /code/node_modules
    networks:
      - public
    depends_on:
      - backend
    restart: unless-stopped
networks:
  public:
  private:
volumes:
  backend-modules: #shared
  db-data:
secrets:
  db-password:
    file: db/password.txt

```
```
services:
  redis:
      image: redis:alpine
      deploy:
        resources:
          limits:
            cpus: '0.50'
            memory:150M
          reservations:
            cpus: '0.25'
            memory: 20M
  web:
    image: nginx:alpine
    enviroment:
      - DEBUG=1
  db:
    image: "postgres:${ENV_VALUE}"

```
# SQL

* docker(-compose) runâ€Š--name=mysql1 -e(nv) MYSQL_ROOT_HOST=% -p 3306:3306 -d mysql/mysql-server
or 
* `sudo docker run -p 13306:3306 --name mysql-docker-local -e MYSQL_ROOT_PASSWORD=Password -d mysql:latest`
* `mysql --host=127.0.0.1 --port=13306 -u root -p`

## login into mysql
* docker logs mysql1 2>&1 | grep GENERATED # check the automatically generated password of root user, copy it
* docker exec -it mysql1 mysql -u root -p # parse and press the Enter key
* docker exec -it [container_name] mysql -uroot -p