# Setup in CentOS

## Install

* `yum install bind-chroot bind-utils`
* `/etc/named.conf`
```
add above options
acl AllowQuery {
        172.16.16.0/24;
        localhost;
        localnets;
};
modify 'listen-on port 53' in options
listen-on port 53 { localnets; }; // Or maby any

modify 'allow-query' in options
allow-query     { AllowQuery; };

add  in options
forwarders {
                8.8.8.8;
                8.8.4.4;
        };

```

* `sudo systemctl enable named --now`
* `sudo firewall-cmd --permanent --add-service=dns`
* `sudo firewall-cmd --reload`
* `nmcli con show`
* `sudo nmcli con edit <device>`
* `> remove ipv4.dns`
* `> set ipv4.dns 127.0.0.1`
* `> save`
* `> quit`
* `sudo systemctl restart NetworkManager.service`

## Create forward Zone

* `touch /var/named/chroot/var/named/malware.boss.db`
* `nano`
```
$TTL 5m

malware.boss. IN SOA dns.malware.boss. dnsadmin.malware.boss (
        1 ; Zone file serial number
        5m ; Refresh time
        3m ; Retry time
        30m ; Expiration time
        5m ) ; Negative TTL

; Name Servers

malware.boss.       IN      NS      dns.malware.boss.

; Address Records

dns          IN      A       172.16.16.201
kaly          IN      A       172.16.16.202
```
* check with `named-checkzone malware.boss malware.boss.db`

```
zone "malware.boss" in {
        type master;
        file "/var/named/chroot/var/named/malware.boss.db";
};
```
* check with `named-checkconf /etc/named.conf`

# Reverse zone

```
$TTL 5m

210.20.172.in-addr.arpa. IN SOA yono.telecom.japan zeke.telecom.japan (
        2 ;
	5m ;
	3m ;
	30m ;
	5m );

210.20.172.in-addr.arpa.        IN	NS	yono.telcom.japan.

135.210.20.172.in-addr.arpa.    IN	PTR     sapporo.telecom.japan.
30.210.20.172.in-addr.arpa.     IN	PTR     kobe.telecom.japan.
166.210.20.172.in-addr.arpa.    IN	PTR     fukuoka.telecom.japan.
240.210.20.172.in-addr.arpa.    IN	PTR     kawasaki.telecom.japan.
195.210.20.172.in-addr.arpa.    IN	PTR     kyoto.telcom.japan.
149.210.20.172.in-addr.arpa.    IN	PTR     yono.telcom.japan.
```

## named.conf update for reverse zone
```
zone "210.20.172.in-addr.arpa" in {
        type master;
        file "/var/named/172.20.210.db";
```


# Client/Users

* set dns config on clients with `nmtui` or settings && Turn off and on network
* `cat /etc/resolv.conf` to verify



# Dig

* dig sapporo.telecom.japan (SOA || MX || TTL || AXFR)
* dig -x 172.20.210.20
* dig @DNS_IP sapporo.telecom.japan