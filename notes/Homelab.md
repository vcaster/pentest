# Proxmox

# usefull

* qm destroy VID (deletes VM)
* qm stop VID
* `sudo apt install spice-vdagent` `systemctl start spice-vdagentd.service` (https://serverfault.com/questions/874309/virt-manager-spice-copy-paste-doesnt-work) 

## Bridge Mirrored port to Virtual port
* nano /etc/network/interfaces
```
auto eno2
iface eno2 inet manual
        up link set $IFACE up
        up link set $IFACE promisc on

auto vmbr2
iface vmbr2 inet manual
        bridge_ports eno2
        bridge_stp off
        bridge_fd 0
        bridge_ageing 0
        up ip link set $IFACE up
        up ip link set $IFACE promisc on
```
* systemctl status networking
* reboot machine

# Add MEtasploitable 2
* create blank vm
* cd /var/lib/vz/images
* mkdir VMID
* copy metasploitable to dir
* `qemu-img convert -f vmdk Metasploitable.vmdk -O qcow2 Metasploitable.qcow2`
* mv Metasploitable.qcow2 ../
* nano /etc/pve/qemu-server/VMID.conf
* edit `ide0: file=local:VMID/Metasploitable.qcow2,size=32G`
* Go to data center on proxmox and enable "Disk Image" on local
* go ahead and start

# Import VM's
* make in root dir ova_import
* copy .ova
* tar xvf file.ova
* qm importovf 300 ./turnkey-core-16.1-buster-amd64.ovf HDD_500GB --format qcow2
* qm importdisk 201 Ubuntu-disk001.vmdk Server-HDD --format raw

# Security Onion
* so-analyst-install -> for GUI (not really Highly recommened)
* sudo soup -> update onion
* sudo so-rule-update

# Wazuh

* Go to downloads page on sec onion
* install for client
* allow on sec onion => `sudo so-allow` wazuh aggent && wazuh reg
* * `so-wazuh-agent-manage` add and extract keys for client

# Ubuntu 20 apt problem
(veducate)
* backup your sources file
`cp /etc/apt/sources.list /etc/apt/sources.list.bak`
* replace the links with the archive address
`sudo sed -i -re 's/([a-z]{2}.)?archive.ubuntu.com|security.ubuntu.com/old-releases.ubuntu.com/g' /etc/apt/sources.list`
* run update again
`sudo apt-get update && sudo apt-get dist-upgrade`

## standalone setup 

* import ova file from web
* vist https://IP - > admin:admin
* management /config/
* * enable osquery
* * enable vuln detector (ubuntu)
* save then restart
* settings / modules -> enable osquery and virus total

# pre template
* apt install mlocate openssh-server curl git net-tools nano screen gcc make terminator
* copy ssh pub key

## ubuntu 22 network setup
/etc/netplan/01-netcfg.yaml 
```
network:
    version: 2
    renderer: networkd
    ethernets:
        ens160:
            link-local: [ ipv4 ]
            dhcp4: no
            addresses:
                - 10.10.90.13/16
            nameservers:
                addresses: [10.10.10.51]
            routes:
                - to: default
                  via: 10.10.10.1
```
* netplan apply

## ubuntu expand disk
```
root@util:~# vgdisplay
<snip>
root@util:~# lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv
<snip>
root@util:~# resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv
<snip>
```

## ubuntu expand disk
```
fdisk /dev/sda
p
n
4
t
lvm
p
w
reboot
vgdisplay
vgextend EnterVolumeGroupNameHere /dev/sda4
lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv
resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv
df -hT
```


# OSquery

## ubuntu/debian
* allow on sec onion => `sudo so-allow` Osquery endpoint
```
export OSQUERY_KEY=1484120AC4E9F8A1A577AEEE97A80C63C9D8B80B
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys $OSQUERY_KEY
sudo add-apt-repository 'deb [arch=amd64] https://pkg.osquery.io/deb deb main'
sudo apt-get update
sudo apt-get install osquery
```
* Go to downloads page on sec onion
* `sudo dpkg -i [packageanme]`
* `systemctl restart laucher.so-launcher`
* go to fleet

## windows 
* install osquery
* Go to downloads page on sec onion and install packages and configs

# Syslogs 
## ubuntu/debian

* `*.* @IP:514` >> /etc/rsyslog
* `service rsyslog restart` || `systemctl restart rsyslog`

## sec onion
* `so-allow` => `s` => `IP or range`

# Winlogbeat

* `so-allow` => `b` => `IP or range`

# Vmware ESXI 7

* install ISO
* register lic and download here `https://customerconnect.vmware.com/web/vmware/evalcenter?p=free-esxi7`

## clone
* create directory in datastore

# Dell 730 

## IDRAC 8 Bug
* comment jdk.tls.disabledA... line in `C:\Program Files\Java\jre1.8.0_301\lib\security\java.security`

# NTP on esxi

* mange -> time and date -> edit NTP -> (start and stop manually) -> 0.pool.ntp.org, 1.pool.ntp.org, 2.pool.ntp.org, 3.pool.ntp.org

# VSAN
* uplinks are phys ports
* create a distrubted switch
* set up vmkern nics across
* cluster -> disk management -> claim disk
* max out MTU -> change in distributed switch properties -> vmkm nics -> pyh switch

# Reset Vcente

* restart -> press `e` on boot
* on linix line, append rw init=/bin/bash
* ctrl + x or f10 to boot
* mount -o remount,rw / 
* passwd
* umount /
* reboot -f
* chage -I -1 -m 0 -M 99999 -E -1 root