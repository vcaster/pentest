# Proxmox

# usefull

* qm destroy VID (deletes VM)
* qm stop VID
* `sudo apt install spice-vdagent` `systemctl start spice-vdagentd.service` (https://serverfault.com/questions/874309/virt-manager-spice-copy-paste-doesnt-work) 
* so-analyst-install __> for GUI (Highly recommened)
* 

# Security Onion

## Bridge Mirrored port to Virtual port
* nano /etc/network/interfaces
```
auto eno2
iface eno2 inet manual
        up link set $IFACE up
        up link set $IFACE promisc on

auto vmbr2
iface vmbr2 inet manual
        bridge_ports eno2
        bridge_stp off
        bridge_fd 0
        bridge_ageing 0
        up ip link set $IFACE up
        up ip link set $IFACE promisc on
```
* systemctl status networking
* reboot machine

# Add MEtasploitable 2
* create blank vm
* cd /var/lib/vz/images
* mkdir VMID
* copy metasploitable to dir
* `qemu-img convert -f vmdk Metasploitable.vmdk -O qcow2 Metasploitable.qcow2`
* mv Metasploitable.qcow2 ../
* nano /etc/pve/qemu-server/VMID.conf
* edit `ide0: file=local:VMID/Metasploitable.qcow2,size=32G`
* Go to data center on proxmox and enable "Disk Image" on local
* go ahead and start

# Import VM's
* make in root dir ova_import
* copy .ova
* tar xvf file.ova
* qm importovf 300 ./turnkey-core-16.1-buster-amd64.ovf HDD_500GB --format qcow2
* qm importdisk 201 Ubuntu-disk001.vmdk Server-HDD --format raw

# Wazuh

* Go to downloads page on sec onion
* install for client
* allow on sec onion => `sudo so-allow` wazuh aggent && wazuh reg
* * `so-wazuh-agent-manage` add and extract keys for client

# Ubuntu 20 apt problem
(veducate)
* backup your sources file
`cp /etc/apt/sources.list /etc/apt/sources.list.bak`
* replace the links with the archive address
`sudo sed -i -re 's/([a-z]{2}.)?archive.ubuntu.com|security.ubuntu.com/old-releases.ubuntu.com/g' /etc/apt/sources.list`
* run update again
`sudo apt-get update && sudo apt-get dist-upgrade`

## standalone setup 

* import ova file from web
* vist https://IP - > admin:admin
* management /config/
* * enable osquery
* * enable vuln detector (ubuntu)
* save then restart
* settings / modules -> enable osquery and virus total


# OSquery

## ubuntu/debian
* allow on sec onion => `sudo so-allow` Osquery endpoint
```
export OSQUERY_KEY=1484120AC4E9F8A1A577AEEE97A80C63C9D8B80B
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys $OSQUERY_KEY
sudo add-apt-repository 'deb [arch=amd64] https://pkg.osquery.io/deb deb main'
sudo apt-get update
sudo apt-get install osquery
```
* Go to downloads page on sec onion
* `sudo dpkg -i [packageanme]`
* `systemctl restart laucher.so-launcher`
* go to fleet

## windows 
* install osquery
* Go to downloads page on sec onion and install packages and configs

# Syslogs 

## ubuntu/debian

* `*.* @IP:514` >> /etc/rsyslog
* `service rsyslog restart` || `systemctl restart rsyslog`

## sec onion
* `so-allow` => `s` => `IP or range`

# Winlogbeat

* `so-allow` => `b` => `IP or range`

# Vmware ESXI 7

* install ISO
* register lic and download here `https://customerconnect.vmware.com/web/vmware/evalcenter?p=free-esxi7`

## clone
* create directory in datastore
