# Pfsense

* Install pfsense to usb (memstick,vga)
* Boot from usb, install, set wan, lan
* connect internet to wan and lan to switch=>access point
* Enable DHCP
* Setup => allow ssh => admin@lan

* add user=> user manager
* Disable IPV6 sys-adv-netw | interface | service  | firewall

* enable firewall log in dashboard
* Feneral-web configurator - themes

# Firewall Consideration
* Traffic processed top-buttom (fIf)
* statefull filtering
* Ingress (In from Internet)
* Egress (opp)
* Blacklist | Whitelisting  
* want to protect commoin in wan vice vesrsa for outpbound

* Floating rules for pin pointing rulls -> Firewall | rules | floating 

* Reject for internals block for external

# Blocking Reject port

* firewall/rules/lan

* Add aliases with ports for grouping -> Firewal Aliases/ Edit (tcp out 80,443,22) (udp out 123,53) (Block All Place under withlog lannet source) (disable rules that allows all out bound)

# ICMP 

`Allowable ICMP's`
|Type Number    | Code  Typeof Message|
|       3       |  N/A  | Destination Unreachable  |
|       8       |  N/A  | ICMP Echo Request Ping   |
|       11      |  N/A  | Time Exceeded            |
|       12      |  N/A  | Parameter Problem        |

`Create ICMP pass Rule` 

(allow all to top to view protocols passing in firewall) | (Diagnostics/Packet capture)

 # Rules Seperator

* Add Seperator =>firewall/rules/(device inf)/Separtor

# Packages 

* System/Package Manageer/Installed packages

## pfBLokerNG

* Firewall/pfBlokerNg -> setup (change vip (10.10.11.1))
* (More research)

# Snort (IDS/IPS)

* Signature based / Protocole based detection --( Finding deviations in protocol.. like usinf ssh on a different port)

* Services/Snort

* Based on rules (signatures)  Services/Snort/Global Settings
* VRT (vul research team) Free( 30 days behind) (paid two weeks update)
* GPL community rules
* ET (Emerging threats) Opene(free) Pro (paid)
* Open AppID

## Setup Snort

* Sign up for free account/confirm in mail (may go to spam)/click email on account/Oinkcode/paste in pfsense rules
* Enable VRT (vul research team) Free( with Oinkcode)
* Enable GPL community rules
* Enable ET (Emerging threats) Open
* Enable OpenAppID
* Set updaye interval and time  
* Check Hide deprecated rules
* Check keep snort settings ans startup/shutdownlogs

### Update Snort
  
* Services/Snort/Update Rules/ Update Rulles

### Setup Intefaces for Snort

* Services/ Snort/ Snort Interfaces => add all interfaces

### Enable IPS or IDS

* IPS => Seclect Interface => Alert Settings -> Check  Send Alerts to Sys Logs 
* IDS => Seclect Interface => Block Settings -> Check  Block Offenders

## Start Snort

* Click on the play button (for each interface)


# Suricate (ips/ids)

* supports multi threading (greatly imrove performance), IP reputation, auto protocol detection
* Best not run Snort and Suricata 

* add rules (similar to snort)
* don't set same update time
* Max Mind => create account/login/services/manage lic keys/generate new keys
* UPDATE
* ADD INTERFACES
* Enable Categories
* For Blocks => Services/Suricata/Blocks vice versa for Alerts
* See Related Logs
# Configure DMZ

* A harden space (can comm with lan) DMZ is for sharing control and monitor traffic
* Allow incoming traffice tp web server (80,443) | allow (ssh 22) corp network access server

------Kinda Grey -------
## Example     
* attrib set internal (in lan 192.168.0.1) | (in DMZ 10.0.0.1)set server connect to static DMZ server (DNS set)
* Add new interface (In web config) as (DMZ)/static ipv4/ set Ip / 24
* add (all outbound from dmz) rules to DMZ interface (pass)/(TCP 80 (source DMZ net))/(DNS 53)source (DMZ net) / destination (any) / log packets (add ntp(port 123),icmp(DMZ source, dest any, logged))
* add rules (Inbound) /UDP 8.8.8.8 port 53
* Set NAt port forwarding (Port forward WAN connections to DMZ)
## with ssh
* On web server (go to ssh.config remove comment and change ssh port)
* sudo systemctl isactive ssh
* sudo systemctl enable ssh
* Nat forward


# Backup settings 

* Diagnostics/Backup & Restore 

# Set Vlan

* Interface -> Assignments -> VLANs
* create tag on LAN
* interface Assignments -> add from avalable ports
* click on name (OPT), enable interface, set description, set range /24
* go to services -> DHCP Server (enable each and set range)
* go to Firewal -> rules (allow all trafic) (protocol -> ANY)

# Setup OpenVPN

* VPN -> wizard
* create certs (2)
* servermode -> Remote Access (User Auth) -> interface -> WAN, add desc, set Tunnel network e.g (10.10.2.0/24) (seprate from wan and lan), set local Network e.g (172.16.16.0/24)
* set max connection
* check (add firewall rule to and through)
* Install open vpn exporter (System->packages-> OpenVPN Client Export package)
* Create a dynamic hostname st no-ip.com (Dynamic DNS-> No-IP hostnames-> create hostname -> add hostname (leave everything else as default) recordtype -> A )
* Service-> dynamic dns -> add -> Service type (No-IP(free) -> add hostname -> add no-ip username and password)
* VPN -> client Export -> Hostnamr res  (no-ip hostname)
* allow port fowarding from your isp to the wan ip on 1194

## full tunnel
* add `redirect-gateway def1` to the config file, before the cert

# Netgate trash

* installing packages issue? - `pkg-static install -f pkg`

# Access serial console

* `sudo screen /dev/ttyUSB0 115200`